/*! Pad and PadUI drawpad API v0.1.0 | Copyright (c) 2014 Rapeapach Suwasri | http://lenkyun.tk/drawpad/license */
!function(a,b,c){var d=[],e;("undefined"==typeof b||"undefined"==typeof console)&&(e="[drawpad] drawpad require jQuery to run, please set-it-up on your page.",d.push(e),console.warn(e)),("undefined"==typeof a.document||"undefined"==typeof console)&&(e="[drawpad] Can't find document, please ensure that you run this script on the browser.",d.push(e),console.warn(e)),c(a,a.document,b,b.extend,d)}("undefined"!=typeof window?window:this,jQuery,function(a,b,c,d,e){var f=function(){var a={},b=0,e={};return a=function(a){a&&(this.indexer=b,this.set(a),e[b++]={})},a.prototype={ex:{},indexer:-1,get:function(a){return"undefined"!=typeof a&&"undefined"!=typeof e[this.indexer][a]?e[this.indexer][a]:0},create:function(a){return e[this.indexer][a]=c.extend(!0,{},this.ex),e[this.indexer][a]},set:function(a){var b,c,e,f,g;return b={data:{},add:function(a,b){return"undefined"==typeof a?!1:("undefined"==typeof this.data[a]&&(this.data[a]=[]),"function"==typeof b&&this.data[a].push(b),!0)},remove:function(a,b){var c,d=0;if("undefined"==typeof this.data[a])return d;for(;-1!==(c=this.data[a].indexOf(b));)this.data[a].splice(c,1),d++;return d},run:function(a,b,c){if("undefined"==typeof this.data[a])return!1;for(var d in this.data[a])try{this.data[a][d](b,c)}catch(e){}return!0},has:function(a,b){for(var c in this.data)if(c===a)return"undefined"!=typeof b&&b(),!0;return!1},list:function(){var a=[];for(var b in this.data)a.push(b);return a},on:function(a,b){this.has(a)&&this.add(a,b)}},c=function(a,b){if("undefined"==typeof a)return!1;if("undefined"!=typeof b)if(arguments.length>2){var c=this.data,e;for(e=0;e<arguments.length-2;e++)c=c[arguments[e]];c[arguments[e]]=arguments[e+1]}else this.data[a]=b;else d(this.data,a);return this},f=function(a){if("undefined"!=typeof a&&"undefined"!=typeof this.data[a]){var b,c;b=this.data;for(var d in arguments){if(c=arguments[d],"undefined"==typeof b[c])return void 0;b=b[c]}return b}return void 0},g=function(a){if("undefined"!=typeof a){var b=this.data,c;for(var d in arguments){if(c=arguments[d],"undefined"==typeof b[c])return!1;b=b[c]}return!0}return!1},e=function(a,b){return"undefined"==typeof a||isNaN(this.data[a])?!1:"undefined"!=typeof b&&b===!0?++this.data[a]:this.data[a]++},this.ex={data:a,event:b,set:c,get:f,add:e,isset:g},this}},a};f=f();var g=function(){var a=10,b=new f({id:-1,index:-1,opacity:255,name:"Layer #-1",width:0,height:0,DOM:{$:!1,element:!1,context:!1,previewPad:!1,contextPad:!1}}),d=0,e=function(a,e,f,g){this.indexer=d;var h=b.create(d++);this.s=b,h.set({id:a,index:a,opacity:255,name:"Layer #"+a,width:f,height:g});var i=c("<canvas></canvas>").attr({id:e+"_"+a,width:f,height:g}).addClass(e),j=c("<canvas></canvas>").attr({width:f,height:g})[0];h.set("DOM",{$:i,element:i[0],context:i[0].getContext("2d"),previewPad:j,contextPad:j.getContext("2d")}),h.event.add("clear"),h.event.add("reorder"),h.event.add("opacity"),h.event.add("rename"),h.event.add("remove"),h.event.add("changethis"),this.order(h.get("id")),this.opacity(255),console.log("%c[drawpad/object/Layer] "+e+"'s layer was created.","font-weight: bold; color: orange;")};return e.prototype={layer:!0,indexer:-1,on:function(a,c){var d=b.get(this.indexer);d.event.has(a)&&d.event.add(a,c)},listEvent:function(){return b.get(this.indexer).event.list()},getDOM:function(a){var c=b.get(this.indexer);return c.isset("DOM",a)?c.get("DOM",a):!1},clear:function(){var a=b.get(this.indexer);return a.isset("DOM","context")&&a.get("DOM","context").clearRect(0,0,a.get("width"),a.get("height")),a.isset("DOM","contextPad")&&a.get("DOM","contextPad").clearRect(0,0,a.get("width"),a.get("height")),a.event.run("clear",this,{}),this},order:function(c){var d=b.get(this.indexer);return"undefined"==typeof c?d.get("index"):(c>=0&&2e3>c&&(d.set("index",c),d.isset("DOM","$")&&d.get("DOM","$").css("z-index",a+c)),d.event.run("reorder",this,{value:c}),this)},opacity:function(a){var c=b.get(this.indexer);return void 0===typeof a?c.get("opacity"):(a>=0&&255>=a?(c.set("opacity",a),c.isset("DOM","$")&&c.get("DOM","$").css("opacity",a/255)):console.error("[drawpad.object.Layer] Opcaity is out of range [0-255]["+a+"]"),c.event.run("opacity",this,{value:a}),this)},name:function(a){var c=b.get(this.indexer);return"undefined"==typeof a?c.get("name"):(c.set("name",String.toString(a)),c.event.run("rename",this,{value:a}),this)},getDataURL:function(){return b.get(this.indexer).get("DOM","element").getDataURL()},remove:function(){var a=b.get(this.indexer);a.get("DOM","$").remove(),c(a.get("DOM","previewPad")).remove(),a.event.run("remove",this,{layer:this})},changethis:function(){b.get(this.indexer).event.run("changethis",this,{layer:this})}},e};g=g();var h=function(){var a;return a=function(b,c,d,e){b&&b.rgba?this.value=b.getInt():"undefined"!=typeof b&&"undefined"!=typeof c&&"undefined"!=typeof d&&"undefined"!=typeof e?this.value=a.toInt(b,c,d,e):isNaN(b)||(this.value=b)},c.extend(a,{value:255,toInt:function(a,b,c,d){if(a.rgba)return a.color();if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d))return!1;var e=a;return e=(e<<8)+b,e=(e<<8)+c,e=(e<<8)+d},toRGBA:function(b){return new a(b)},toCSS:function(a){return a||a.rgba?"rgb("+a.red()+", "+a.green()+", "+a.blue()+")":!1},toCSSFromInt:function(a){var b=this.toRGBA(a);return this.toCSS(b)}}),a.prototype={rgba:!0,red:function(a){if(void 0===a||isNaN(a))return this.value>>24&255;if(a>=0&&255>=a){var b=16777215&this.value;b+=a<<24,this.value=b}else console.warn("[drawpad/object/RGBA.red] Color is out of bound [0-255][%i]",a)},green:function(a){if(void 0===a||isNaN(a))return this.value>>16&255;if(a>=0&&255>=a){var b=4278255615&this.value;b+=a<<16,this.value=b}else console.warn("[drawpad/object/RGBA.green] Color is out of bound [0-255][%i]",a)},blue:function(a){if(void 0===a||isNaN(a))return this.value>>8&255;if(a>=0&&255>=a){var b=4294902015&this.value;b+=a<<8,this.value=b}else console.warn("[drawpad/object/RGBA.blue] Color is out of bound [0-255][%i]",a)},alpha:function(a){if(void 0===a||isNaN(a))return 255&this.value;if(a>=0&&255>=a){var b=4294967040&this.value;b+=a,this.value=b}else console.warn("[drawpad/object/RGBA.alpha] Alpha level is out of bound [0-255][%i]",a)},getCSS:function(){return this.value},getInt:function(){return this.value}},a};h=h();var i=function(){var a,b=1024;return a=function(b,c){b&&b.position?this.value=b.getInt():isNaN(b)||isNaN(c)?isNaN(b)?void 0!==b.x&&void 0!==b.y&&(this.value=a.toInt(b.x,b.y)):this.value=b:this.value=a.toInt(b,c)},c.extend(a,{toInt:function(a,c){var d;if(a&&a.position)c=a.y(),a=a.x();else if(void 0!==a.x&&void 0!==a.y)c=a.x,a=a.y;else if(isNaN(a)||isNaN(c))return!1;return d=a+b,d=(d<<12)+(c+b)},toPosition:function(b){return new a(b)},compare:function(b,c){var d,e;return d=new a(b).getInt(),e=new a(c).getInt(),d===e}}),a.prototype={value:0,position:!0,x:function(a){var b;return void 0===a||isNaN(a)?(this.value>>12&4095)-1024:void(a>=-1024&&1024>=a?(b=4095&this.value,b+=a+1024<<12,this.value=b):console.warn("[drawpad/object/Position.x] Position is out of bound [n1024-1024][%i]",a))},y:function(a){var b;return void 0===a||isNaN(a)?(4095&this.value)-1024:void(a>=-1024&&1024>=a?(b=16773120&this.value,b+=a+1024,this.value=b):console.warn("[drawpad/object/Position.y] Position is out of bound [n1024-1024][%i]",a))},getInt:function(){return this.value},compare:function(b){return a.compare(this,b)}},a};i=i();var j=function(){var a=function(b){return b||(b={}),c.extend({},a,b)};return d(a,{mode:!0,name:"NewMode",thisIndex:-1,dataCheck:function(a){return a[this.defines.drawType]===this.thisIndex},eventTrigger:function(){console.warn("[drawpad.object.Mode] call undefined eventTrigger!![%s][%0]",this.name,this)},eventSave:function(){console.warn("[drawpad.object.Mode] call undefined eventSave!![%s][%0]",this.name,this)},play:function(){console.warn("[drawpad.object.Mode] call undefined play!![%s][%0]",this.name,this)},draw:function(){console.warn("[drawpad.object.Mode] call undefined draw!![%s][%0]",this.name,this)},data:{}}),a};j=j();var k=function(){var a={};return d(a,{Settings:f,Layer:g,RGBA:h,Position:i,Mode:j}),a};k=k(),f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;var l=function(){var e={},f,g,h=0;e.extend=c.extend,f=new k.Settings({TIME_DELAY:10,replaySpeed:1,CANVAS_WIDTH:800,CANVAS_HEIGHT:480,CANVAS_EVENTOFFSET:100,HISTORY_LIMIT:!1,LAYERPAD_WIDTH:150,SAMEPOINT_LIMIT:1}),f=f.create("0");var i=f.event,j=d({},f.event);return delete f.event,g=new k.Settings({rgba:new k.RGBA(0,0,0,100),width:20,draw:0,layer:0}),g=g.create("0"),a.style=g,e.extend({setting:f,style:g}),e.extend({settings:f,on:function(a,b){return i.on(a,b)},regisEvent:function(a,b,c){return i.add(a,b,c)},init:function(h){var i=d({},j);return i.add("ok"),setTimeout(function(){var d;if(console.groupCollapsed("%c[drawpad.history.replay] Start init state.","color: darkgreen; font-weight: bold"),"undefined"==typeof e.layer)return d="Init not successful, layer not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d),void i.run("error",e,{message:d});if(e.layer.regisPad(e),e.layer.root(h.layer),console.log("%c[drawpad.init] Init object.Layer Created.","font-weight: bold; color: darkgreen"),"undefined"==typeof e.modes)return d="Init not successful, modes not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d),void i.run("error",e,{message:d});if(e.modes.regisPad(e),console.log("%cModes node has been set.","font-weight: bold; color: darkgreen"),setInterval(function(){return u.get("replayState")?!1:void e.modes.get(g.get("draw")).eventTrigger()},f.get("TIME_DELAY")),"undefined"==typeof e.history)return d="Init not successful, History not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d),void i.run("error",e,{message:d});e.history.regisPad(e),console.log("%cHistory node has been set.","font-weight: bold; color: darkgreen");var j=new k.Layer(0,"drawpad-write",f.get("CANVAS_WIDTH"),f.get("CANVAS_HEIGHT"));return e.layer.write(j),h.write.append(e.layer.write().getDOM("$")),console.log("%c[drawpad.init] Pen layer has been set.","font-weight: bold; color: darkgreen"),e.layer.create(),e.layer.index(0),console.groupEnd(),"undefined"==typeof e.mouse?(d="Init not successful, mouse not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d,this.mouse),void i.run("error",e,{message:d})):(e.mouse.regisPad(e),c(b).mousemove(e.mouse.move),c(a).mousedown(e.mouse.down),c(a).mouseup(e.mouse.up),console.log("%cEvents have been set.","font-weight: bold; color: darkgreen"),e.setStyle("rgba",e.getStyle("rgba")),e.setStyle("width",e.getStyle("width")),void i.run("ok",e,{}))}),{on:function(a,b){return i.on(a,b)}}},setStyle:function(a,b){var d,f,j,l;if(void 0!==typeof b)switch(String(a).toLowerCase()){case"rgba":f=new k.RGBA(b),j=f.getCSS(),l=f.alpha()/255,d=e.layer.write().getDOM("context"),d.strokeStyle=j,d.fillStyle=j,e.layer.write().opacity(f.alpha()),d=e.layer.getLayer().getDOM("context"),d.globalAlpha=l,d=e.layer.getLayer().getDOM("contextPad"),d.globalAlpha=l,g.set("rgba",f),i.run("colorChange",this,{rgba:f});break;case"width":d=e.layer.write().getDOM("context"),d.lineWidth=b,g.set("width",b),i.run("widthChange",this,{width:b});break;case"layer":g.set("layer",b),i.run("layerChange",this,{index:b,layer:e.layer()});break;case"mode":e.modes.get(b,!0)!==!1&&(g.set("draw",b),h=b);break;case"flow":b===!0?c("#flowzone").show():c("#flowzone").hide()}else for(var m in a)e.setStyle(m,a[m]);return this},getStyle:function(a){return g.get(a)}}),e};l=l();var m=function(){var b,e;e=new k.Settings({index:0,write:!1,root:!1,count:0,pad:!1,indexCount:0}),e=e.create(0);var f=e.event,g=[];f.add("create"),f.add("remove"),f.add("removeAll"),f.add("indexChange"),f.add("changeLayerSetting"),f.add("clearLayer"),f.add("reset"),b=function(a){return"undefined"==typeof a&&(a=h.layer.getLayer()),"undefined"==typeof a.layer&&(a=h.layer.getLayer(a)),a};var h=!1;return d(b,{on:function(a,b){return f.on(a,b)},regisPad:function(a){h===!1&&(h=a)},root:function(a){return e.get("root")!==!1||void 0===a?e.get("root"):(e.set("root",a),this)},write:function(a){return e.get("write")!==!1||"undefined"==typeof a?e.get("write"):void e.set("write",a)},create:function(){b=new k.Layer(e.add("indexCount",!0),"drawpad",h.settings.get("CANVAS_WIDTH"),h.settings.get("CANVAS_HEIGHT")),e.get("root").append(b.getDOM("$")),n.get("CreateLayer").eventSave(),g.push(b),a.data=g,f.run("create",this,{layer:b})},remove:function(a){var c=g,d;if(isNaN(d))for(;-1!==(d=c.indexOf(a));)this.remove(d);else"undefined"!=typeof c[d]&&(f.run("remove",this,{layer:b}),c[d].remove(),c.splice(d,1));return this},removeAll:function(){c.each(g,function(a,b){f.run("remove",this,{layer:b}),b.getDOM("$").remove()}),g=[],this.resetCount(),console.log("%c[drawpad.layer.removeAll] All layer was removed.","font-weight: bold; color: darkorange"),f.run("removeAll",this,{})},index:function(a){if("undefined"==typeof a)return this.getLayer();if(isNaN(a)){if(a.layer){var b;if(-1===(b=g.indexOf(a)))return!1;this.index(b),f.run("changeIndex",this,{layer:this.getLayer()})}}else{if(0>a)return!1;if(a===e.get("index"))return!0;if(a>g.length)return!1;this.write().order(a),e.set("index",a),console.log("%c[drawpad.layer.index] Layer index changed to [%i].","font-weight: bold; color: darkorange",a);try{h.setStyle("layer",a)}catch(c){console.warn("[drawpad.layer.index] Error in style.layer.")}this.getLayer().changethis(),f.run("changeIndex",this,{layer:this.getLayer()})}return!0},set:function(a){var b,c,d;switch(c=this(),b=this.defines.options,a.mode){case b.opacity:d=c.opacity(),c.opacity(a.value);break;case b.name:d=c.name(),c.name(a.value)}var e={mode:a.mode,oldvalue:d,newvalue:a.value};h.modes.get("ChangeLayerSetting").eventSave(e),f.run("changeLayerSetting",this,e)},clear:function(){c.each(g,function(a,b){b.clear(),f.run("clear",this,{layer:b})})},defines:{options:{opacity:0,name:1,order:2}},getLayer:function(a){return"undefined"==typeof a?g[e.get("index")]:a>g.length?!1:g[a]},list:function(){return g},resetCount:function(){e.set("count",0),f.run("reset",this,{})}}),b};m=m();var n=function(){var a={},b=new k.Settings({data:{}});return b=b.create(0),c.extend(a,{regisPad:function(a){var c=b.get("data");for(var d in c)c[d].regisPad(a)},add:function(a,c){return c&&c.mode?void(b.isset("data",a)||b.isset("data",c.name)?console.warn("[drawpad.modes.add] index [%d] OR name [%s] was already defined.",a,c.name):(c.defines=this.defines,b.set("data",a,c),b.set("data",c.name,c),this.defineMode[c.name]=a,this.defineMode[a]=c.name,console.log("%c[drawpad.modes.add] drawpad.object.Mode named [%s] was added to drawpad.modes/[%d], drawpad.modes/%s","font-weight: bold; color: darkred",c.name,a,c.name))):(console.error("[drawpad.modes.add] Invalid parameter type."),!1)},get:function(a,c){return b.isset("data",a)?b.get("data",a):"undefined"!=typeof c&&c?!1:new k.Mode},defineMode:{},defines:{drawType:0,time:1,name:2,axis:3,value:3,layer:4}}),a};n=n();var o=function(){var a=!1,b=[],d=0,e={x:0,y:0},f=!1,g=!1,h=!1;return k.Mode({name:"Line",thisIndex:0,regisPad:function(b){a===!1&&(a=b)},play:function(b,c){function d(){c(i)}function e(){for(var c=j;c-->0;){var l=new k.Position(b[f.axis][g-1]),m=new k.Position(b[f.axis][g]);if(i.draw(l,m),g++,g>=h-1)return i.eventSave(),void d()}setTimeout(function(){e()},a.settings.get("TIME_DELAY")/a.settings.get("replaySpeed"))}var f=this.defines;if(!this.dataCheck(b))return!1;if(b[f.axis].length<2)return!0;a.layer.index(b[f.layer]),a.setStyle(b[f.color],b[f.width]);var g=1,h=b[f.axis].length,i=this,j=a.settings.get("replaySpeed")/a.settings.get("TIME_DELAY");setTimeout(function(){e()},a.settings.get("TIME_DELAY")/a.settings.get("replaySpeed"))},draw:function(b,c){b.compare(c)&&(c.x(c.x()+1),c.y(c.y()+1));var d=a.layer.write().getDOM("context");d.beginPath(),d.lineJoin="round",d.lineCap="round",d.moveTo(b.x(),b.y()),d.lineTo(c.x(),c.y()),d.closePath(),d.stroke()},eventTrigger:function(){var b=a.mouse;g!==b.mouseClicked?b.mouseInner?b.mouseClicked?this.eventStart():this.eventStop():b.mouseClicked||this.eventStop():b.mouseClicked&&b.mouseIn?f!==b.mouseIn?b.mouseIn?this.eventStart():this.eventStop():h&&this.eventAdd():b.mouseIn||this.eventStop(),g=b.mouseClicked,f=b.mouseIn,h?a.setStyle("flow",!0):a.setStyle("flow",!1)},eventStart:function(){var c=a.mouse;h=!0;var d=new k.Position(c.mouse.pos),f=[];f.push(d.getInt()),b=f,e=d,a.history.countTime()},eventAdd:function(){var c=a.mouse,f=new k.Position(c.mouse.pos);return f.compare(e)?d++:d=0,d>a.settings.get("SAMEPOINT_LIMIT")?!1:(this.draw(e,f),b.push(f.getInt()),e=f,void a.history.countTime())},eventStop:function(){return h?(h=!1,d=0,this.eventAdd(),this.eventSave(),c("#value_jsize").html((u.getSize()/1024).toFixed(2)+" KB"),void c("#value_msize").html((u.getMsgPackSize()/1024).toFixed(2)+" KB")):!1},eventSave:function(){var c=this.defines,d={};d[c.drawType]=this.thisIndex,d[c.time]=a.history.getTimeStep()-b.length,d[c.axis]=b,d[c.layer]=a.layer.index(),a.history.countEvent(),a.history.addEvent(d);var e=a.layer.getLayer(),f=a.layer.write().getDOM("element");e.getDOM("context").drawImage(f,0,0),e.getDOM("contextPad").drawImage(f,0,0),a.layer.write().getDOM("context").clearRect(0,0,a.settings.get("CANVAS_WIDTH"),a.settings.get("CANVAS_HEIGHT")),a.history.addHistory({data:{img:a.layer.getLayer().getDOM("element").toDataURL(),mode:this.thisIndex,line:!0,layer:a.layer()},undo:function(b,c){for(a.layer.index(this.data.layer);b.back()!==!1&&b.now().data.line!==!0&&b.now().data.layer!==this.data.layer;);b.index()<0?a.layer().clear():a.layer().setDataURL(b.now().data.img),"function"==typeof c&&c()},redo:function(b,c){a.layer.index(this.data.layer),a.layer().setDataURL(this.data.img),"function"==typeof c&&c()}})}})};o=o();var p=function(){var a=!1;return k.Mode({name:"CreateLayer",thisIndex:1,regisPad:function(b){a===!1&&(a=b)},play:function(b,c){return this.dataCheck(b)?(a.layer.create(),this.eventSave(),void(c&&c(this))):!1},eventTrigger:function(){},eventSave:function(){var b={};b[this.defines.drawType]=this.thisIndex,b[this.defines.time]=a.history.getTimeStep(),a.history.countTime(),a.history.countEvent(),a.history.addEvent(b),a.history.addHistory({data:{layer:a.layer.getLayer()},undo:function(b,c){a.layer.remove(this.data.layer),"function"==typeof c&&c()},redo:function(b,c){a.layer.create(),"function"==typeof c&&c()}})}})};p=p();var q=function(){var a=!1;return k.Mode({name:"ChangeLayerSetting",regisPad:function(b){a===!1&&(a=b)},thisIndex:2,play:function(b,c){var d=this.define;return this.dataCheck(b)?(isNaN(b[d.axis])?a.layer.set(b[d.layer],{mode:b[d.axis][0],value:b[d.axis][1]},!1):a.layer.set(b[d.layer],a.layer.value.getValue(b[d.value],!1)),this.eventSave(),void(c&&c(this))):!1},eventTrigger:function(){},eventSave:function(b){var c={},e=this.defines;c[e.drawType]=this.thisIndex,c[e.mode]=b.mode,c[e.value]=b.newvalue,c[e.time]=a.history.getTime(),a.history.countTime(),a.history.countEvent(),a.history.addEvent(c),a.history.addHistory({data:d(b,{mode:this.thisIndex,layer:a.layer()}),undo:function(b,c){a.layer.index(this.data.layer),a.layer.set({mode:this.data.mode,value:this.data.oldvalue}),"function"==typeof c&&c()},redo:function(b,c){a.layer.index(this.data.layer),a.layer.set({mode:this.data.mode,value:this.data.newvalue}),"function"==typeof c&&c()}})}})};q=q();var r=function(){var a=new k.Settings({pad:!1});a=a.create("pad");var b=!1;return k.Mode({name:"ChangeStyle",thisIndex:3,regisPad:function(a){b===!1&&(b=a)},play:function(a,c){if(!this.dataCheck(a))return!1;var d=this.defines;b.setStyle(a[d.name],a[d.value]),this.eventSave(),c&&c(this)},eventTrigger:function(){},eventSave:function(a){var c={};c[this.defines.drawType]=this.thisIndex,c[this.defines.name]=a.name,c[this.defines.value]=a.style,c[this.defines.time]=b.history.getTimeStep(),b.history.countTime(),b.history.countEvent(),b.history.addEvent(c),b.history.addHistory({data:{layer:b.layer.getLayer()},undo:function(a,b){"function"==typeof b&&b()},redo:function(a,b){"function"==typeof b&&b()}})}})};r=r();var s=function(){return n.add(0,o),n.add(1,p),n.add(2,q),n.add(3,r),n};n=s(),s=void 0,o=void 0,p=void 0,q=void 0,r=void 0;var t=function(){var a=new k.Settings({pad:!1}),b=!1;a=a.create("mouse");var c;return c={mouseClicked:!1,mouseIn:!1,mouseInner:!1,regisPad:function(a){b===!1&&(b=a)},mouse:{pos:{x:0,y:0}},down:function(a){1===a.which&&(c.mouseClicked=!0)},up:function(a){1===a.which&&(c.mouseClicked=!1)},move:function(a){var d=b.layer.write().getDOM("$").offset();c.mouse.pos.x=a.pageX-d.left,c.mouse.pos.y=a.pageY-d.top,c.overcheck()},overcheck:function(){c.mouseIn=c.mouse.pos.x>=-b.settings.get("CANVAS_EVENTOFFSET")&&c.mouse.pos.x<=b.settings.get("CANVAS_WIDTH")+b.settings.get("CANVAS_EVENTOFFSET")&&c.mouse.pos.y>=-b.settings.get("CANVAS_EVENTOFFSET")&&c.mouse.pos.y<=b.settings.get("CANVAS_HEIGHT")+b.settings.get("CANVAS_EVENTOFFSET")?!0:!1,c.mouseInner=c.mouse.pos.x>=0&&c.mouse.pos.x<=b.settings.get("CANVAS_WIDTH")&&c.mouse.pos.y>=0&&c.mouse.pos.y<=b.settings.get("CANVAS_HEIGHT")?!0:!1}}};t=t();var u=function(){var a=-1,b=-1,c=[],d=[],e=!1,f=!1,g=!1,h=!1,i={get:function(a){return"replayState"===a?g:void 0},regisPad:function(a){e===!1&&(e=a)},undo:function(){if(a>0&&d[a-1]){var b=--a,e={back:function(){return b>0?(b--,this.now()):!1},now:function(){return c[b]},index:function(){return b}};d[a].undo(e)}},redo:function(){if(a<d.length){var b=++a,e={forward:function(){return b>0?(b++,this.now()):!1},now:function(){return c[b]},index:function(){return b}};d[a].redo(e)}},clearRedo:function(){d.length=a,c.length=a+1},clearHistory:function(){d=[],c=[]},countTime:function(){b++},getTimeStep:function(){return b},countEvent:function(){a++},addHistory:function(a){"undefined"!=typeof a.undo&&"undefined"!=typeof a.redo&&"undefined"!=typeof a.data&&d.push(a)},addEvent:function(a){c.push(a)},replay:function(){function d(){f=!1,h&&(h=!1,g=!1,console.debug("[drawpad.history.replay] index = [%s], frame = [%s] [%ss:%sms], countPerFrame = [%s], mode = [%s]"," END".slice(-4),("     "+m).slice(-5),("000"+Math.floor(m*e.settings.TIME_DELAY/1e3)).slice(-3),("   "+Math.floor(m*e.settings.TIME_DELAY%1e3)).slice(-3),("      "+e.settings.replaySpeed).slice(-6),"LAST"),console.log("%c[drawpad.history.replay] End replay state.","color: darkgreen; font-weight: bold"),console.groupEnd()),p.call&&p.call()}function i(){for(p.call&&(p.call=!1);j[n][e.modes.defines.time]<=Math.floor(m);){if(f)return void(p.call=i);if(console.debug("[drawpad.history.replay] index = [%s], frame = [%s] [%ss:%sms], countPerFrame = [%s], mode = [%s]",("    "+n).slice(-4),("     "+m).slice(-5),("000"+Math.floor(m*e.settings.TIME_DELAY/1e3)).slice(-3),("   "+Math.floor(m*e.settings.TIME_DELAY%1e3)).slice(-3),("      "+e.settings.replaySpeed).slice(-6),e.modes.get(j[n][e.modes.defines.drawType]).name),f=!0,e.modes.get(j[n][e.modes.defines.drawType]).play(j[n],d),n++,n>=o)return h=!0,c=j,b=k,a=l,!0}m+=e.settings.get("replaySpeed"),setTimeout(i,1)}if(g===!0)return!1;g=!1,console.groupCollapsed("%c[drawpad.history.replay] Start replay state.","color: darkgreen; font-weight: bold"),this.clearRedo();var j=c,k=b,l=a;b=0,a=0,c=[],this.clearHistory(),e.layer.removeAll(),e.layer.write().clear();var m=0,n=0,o=j.length,p={call:!1};i()},getSize:function(){return JSON.stringify(c).length},getMsgPackSize:function(){return msgpack.pack(c).length}};return i};u=u(),l.extend({layer:m,modes:n,mouse:t,history:u,object:k});var v=function(){function a(){f.pad.layer.create()}function b(a,b){var d=c(f.layer.example).clone().removeClass("example");h[b.layer.indexer]=d,d.children(f.layer.parts.preview).append(b.layer.getDOM("previewPad")),g.run("layerCreated",e,{layer:b.layer,element:d})}var e={},f={pad:!1,layer:{example:c("<div></div>"),parts:{preview:".preview",changeThis:".preview"}},button:{layer:{create:c("")}}},g={},h={};return e.extend=d,e.extend({event:g,on:function(a,b){return g.on(a,b),this},layer:{list:function(){var a=f.pad.layer.list(),b=[];for(var c in a)b.push({indexer:a[c].indexer,element:h[a[c].indexer]});return{list:b,selected:f.pad.layer.getLayer().indexer}}},init:function(h){d(!0,f,h);var i;if(!(f.pad&&f.pad.layer&&f.pad.object))throw"No pad detected in option, PadUI needs Pad. (option.pad)";var j=new f.pad.object.Settings({});i=j.create("0").event,d(g,i);var k=f.pad.layer.list();for(var l in k)b(h.pad.layer,{layer:k[l]});return i.add("ok"),g.add("layerCreated"),setTimeout(function(){f.pad.layer.on("create",b),c(f.button.layer.create).click(a),i.run("ok",e,{})},100),{on:function(a,b){i.on(a,b)}}}}),e};v=v(),v.extend({});var w={},x={Pad:l,PadUI:v,window:a,jQuery:c,document:b},y={},z=function(a){return a&&x[a]?x[a]:!1};d(y,{ok:{status:function(){return 0===e.length},call:function(a){a({get:z})}},error:{status:function(){return 0!==e.length},call:function(a){a(e)}}}),w.on=function(a,d){return c(b).ready(function(){"undefined"!=typeof y[a]&&y[a].status()&&y[a].call(d)}),this},a.drawpad=w});