/*! Pad and PadUI drawpad API v0.1.0 | Copyright (c) 2014 Rapeapach Suwasri | http://lenkyun.tk/drawpad/license */
!function(a,b,c,d,e){var f=[],g;("undefined"==typeof b||"undefined"==typeof console)&&(g="[drawpad] drawpad require jQuery to run, please set-it-up on your page.",f.push(g),console.warn(g)),("undefined"==typeof a.document||"undefined"==typeof console)&&(g="[drawpad] Can't find document, please ensure that you run this script on the browser.",f.push(g),console.warn(g)),"undefined"==typeof c&&"undefined"==typeof d&&(c=function(){},g="[drawpad] drawpad require RequireJS to run, please set-it-up on your page.",f.push(g),console.warn(g)),e(a,a.document,b,b.extend,f,c)}("undefined"!=typeof window?window:this,jQuery,require,define,function(a,b,c,d,e,f){var g=function(){var a={};a=function(a){a&&(this.set(a),b[this]={})};var b={};return a.prototype={ex:{},get:function(a){return"undefined"!=typeof a&&"undefined"!=typeof this[a]?b[this][a]:0},create:function(a){return b[this][a]=c.extend({},this.ex),b[this][a]},set:function(a){var b,c,e,f,g;return b={data:{},add:function(a,b){return"undefined"==typeof a?!1:("undefined"==typeof this.event.data[a]&&(this.data[a]=[]),"function"==typeof b&&this.data[a].push(b),!0)},remove:function(a,b){var c,d=0;if("undefined"==typeof this.data[a])return d;for(;-1!==(c=this.data[a].indexOf(b));)this.data[a].splice(c,1),d++;return d},run:function(a,b,c){if("undefined"==typeof this.data[a])return!1;for(var d in this.data[a])try{this.data[a][d](b,c)}catch(e){}return!0},has:function(a,b){for(var c in this.data)if(c===a)return"undefined"!=typeof b&&b(),!0;return!1},list:function(){var a=[];for(var b in this.data)a.push(b);return a},on:function(a,b){this.has(a)&&this.add(a,b)}},c=function(a,b){if("undefined"==typeof a)return!1;if("undefined"!=typeof b)if(arguments.length>2){var c=this.data[a][b],e;for(e=2;e<arguments.length-2;e++)c=c[arguments[e]];c[arguments[e]]=arguments[e+1]}else this.data[a]=b;else d(this.data,a);return this},f=function(a){if("undefined"!=typeof a&&"undefined"!=typeof this.data[a]){var b,c;b=this.data;for(var d in arguments){if(c=arguments[d],"undefined"==typeof b[c])return void 0;b=b[c]}return b}return void 0},g=function(a){if("undefined"!=typeof a&&"undefined"!=typeof this.data[a]){var b,c;for(var d in arguments){if(c=arguments[d],"undefined"==typeof b[c])return!1;b=b[c]}return!0}return!1},e=function(a,b){return"undefined"==typeof a||isNaN(this.data[a])?!1:"undefined"!=typeof b&&b===!0?++this.data[a]:this.data[a]++},this.ex={data:a,event:b,set:c,get:f,add:e,isset:g},this}},a};g=g();var h=function(){var a=10,b=new g({id:-1,index:-1,opacity:255,name:"Layer #-1",width:0,height:0,DOM:{$:!1,element:!1,context:!1,previewPad:!1,contextPad:!1}}),d=function(a,d,e,f){var g=b.create(this);g.set({id:a,index:a,opacity:255,name:"Layer #"+a,width:e,height:f});var h=c("<canvas></canvas>").attr({id:d+"_"+this.id,width:e,height:f}).addClass(d),i=c("<canvas></canvas>").attr({width:e,height:f})[0];g.set("DOM",{$:h,element:h[0],context:h[0].getContext("2d"),previewPad:i,contextPad:i.getContext("2d")}),g.event.add("clear"),g.event.add("reorder"),g.event.add("opacity"),g.event.add("rename"),g.event.add("remove"),g.event.add("changethis"),this.order(g.get("id")),this.opacity(255),console.log("%c[drawpad/object/Layer] "+d+"'s layer was created.","font-weight: bold; color: orange;")};return d.prototype={layer:!0,on:function(a,c){var d=b.get(this);d.event.has(a)&&d.event.add(a,c)},listEvent:function(){return b.event.list()},getDOM:function(a){var c=b.get(this);return c.isset("DOM",a)?c.get("DOM",a):!1},clear:function(){var a=b.get(this);return a.isset("DOM","context")&&a.get("DOM","context").clearRect(0,0,a.width,a.height),a.isset("DOM","contextPad")&&a.get("DOM","contextPad").clearRect(0,0,a.width,a.height),this.clearPreview(),a.event.run("clear",this,{}),this},order:function(c){var d=b.get(this);return"undefined"==typeof c?d.get("index"):(c>=0&&2e3>c&&(d.set("index",c),d.isset("DOM","$")&&d.get("DOM","$").css("z-index",a+c)),d.event.run("reorder",this,{value:c}),this)},opacity:function(a){var c=b.get(this);return void 0===typeof a?c.get("opacity"):(a>=0&&255>=a?(c.set("opacity",a),c.isset("DOM","$")&&c.get("DOM","$").css("opacity",a/255)):console.error("[drawpad.object.Layer] Opcaity is out of range [0-255]["+a+"]"),c.event.run("opacity",this,{value:a}),this)},name:function(a){var c=b.get(this);return"undefined"==typeof a?c.get("name"):(c.set("name",String.toString(a)),c.event.run("rename",this,{value:a}),this)},getDataURL:function(){return b.get(this).get("DOM","element").getDataURL()},remove:function(){var a=b.get(this);a.get("DOM","$").remove(),c(a.get("DOM","previewPad")).remove(),a.event.run("remove",this,{layer:this})},changethis:function(){b.get(this).event.run("changethis",this,{layer:this})}},d};h=h();var i=function(){var a,b;return a=new g({value:255}),b=function(c,d,e,f){var g=a.create(this);c&&c.rgba?g.set("value",c.getInt()):"undefined"!=typeof c&&"undefined"!=typeof d&&"undefined"!=typeof e&&"undefined"!=typeof f?g.set("value",b.toInt(c,d,e,f)):isNaN(c)||g.set("value",c)},c.extend(b,{toInt:function(a,b,c,d){if(a.rgba)return a.color();if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d))return!1;var e=a;return e=(e<<8)+b,e=(e<<8)+c,e=(e<<8)+d},toRGBA:function(a){return new b(a)},toCSS:function(a){return a||a.rgba?"rgb("+a.red()+", "+a.green()+", "+a.blue()+")":!1},toCSSFromInt:function(a){var b=this.toRGBA(a);return this.toCSS(b)}}),b.prototype={rgba:!0,red:function(b){var c=a.get(this);if(void 0===b||isNaN(b))return c.get("value")>>24&255;if(b>=0&&255>=b){var d=16777215&c.get("value");d+=b<<24,c.set("value",d)}else console.warn("[drawpad/object/RGBA.red] Color is out of bound [0-255][%i]",b)},green:function(b){var c=a.get(this);if(void 0===b||isNaN(b))return c.get("value")>>16&255;if(b>=0&&255>=b){var d=4278255615&c.get("value");d+=b<<16,c.set("value",d)}else console.warn("[drawpad/object/RGBA.green] Color is out of bound [0-255][%i]",b)},blue:function(b){var c=a.get(this);if(void 0===b||isNaN(b))return c.get("value")>>8&255;if(b>=0&&255>=b){var d=4294902015&c.get("value");d+=b<<8,c.set("value",d)}else console.warn("[drawpad/object/RGBA.blue] Color is out of bound [0-255][%i]",b)},alpha:function(b){var c=a.get(this);if(void 0===b||isNaN(b))return 255&c.get("value");if(b>=0&&255>=b){var d=4294967040&c.get("value");d+=b,c.set("value",d)}else console.warn("[drawpad/object/RGBA.alpha] Alpha level is out of bound [0-255][%i]",b)},getCSS:function(){return a.get(this).get("value")},getInt:function(){return a.get(this).get("value")}},b};i=i();var j=function(){var a,b,d=1024;return a=new g({value:0}),b=function(c,d){var e=a.create(this);c&&c.position?e.set("value",c.getInt()):isNaN(c)||isNaN(d)?isNaN(c)?void 0!==c.x&&void 0!==c.y&&e.set("value",b.toInt(c.x,c.y)):e.set("value",c):e.set("value",b.toInt(c,d))},c.extend(b,{toInt:function(a,b){var c;if(a&&a.position)b=a.y(),a=a.x();else if(void 0!==a.x&&void 0!==a.y)b=a.x,a=a.y;else if(isNaN(a)||isNaN(b))return!1;return c=a+d,c=(c<<12)+(b+d)},toPosition:function(a){return new b(a)},compare:function(a,c){var d,e;return d=new b(a).getInt(),e=new b(c).getInt(),d===e}}),b.prototype={position:!0,x:function(b){var c=a.get(this),d;return void 0===b||isNaN(b)?(c.get("value")>>12&4095)-1024:void(b>=-1024&&1024>=b?(d=4095&c.get("value"),d+=b+1024<<12,c.set("value",d)):console.warn("[drawpad/object/Position.x] Position is out of bound [n1024-1024][%i]",b))},y:function(b){var c=a.get(this),d;return void 0===b||isNaN(b)?(4095&c.get("value"))-1024:void(b>=-1024&&1024>=b?(d=16773120&c.get("value"),d+=b+1024,c.set("value",d)):console.warn("[drawpad/object/Position.y] Position is out of bound [n1024-1024][%i]",b))},getInt:function(){return a.get(this).get("value")},compare:function(a){return b.compare(this,a)}},b};j=j();var k=function(){var a=function(b){return b||(b={}),c.extend({},a,b)};return d(a,{mode:!0,name:"NewMode",thisIndex:-1,dataCheck:function(a){return a[this.defines.drawType]===this.thisIndex},eventTrigger:function(){console.warn("[drawpad.object.Mode] call undefined eventTrigger!![%s][%0]",this.name,this)},eventSave:function(){console.warn("[drawpad.object.Mode] call undefined eventSave!![%s][%0]",this.name,this)},play:function(){console.warn("[drawpad.object.Mode] call undefined play!![%s][%0]",this.name,this)},draw:function(){console.warn("[drawpad.object.Mode] call undefined draw!![%s][%0]",this.name,this)},data:{}}),a};k=k();var l=function(){var a={};return d(a,{Settings:g,Layer:h,RGBA:i,Position:j,Mode:k}),a};l=l(),g=void 0,h=void 0,i=void 0,j=void 0,k=void 0;var m=function(){var e={},f,g;e.extend=c.extend,f=new l.Settings({TIME_DELAY:10,replaySpeed:1,CANVAS_WIDTH:800,CANVAS_HEIGHT:480,CANVAS_EVENTOFFSET:100,HISTORY_LIMIT:!1,LAYERPAD_WIDTH:150,SAMEPOINT_LIMIT:1}),f=f.create(e);var h=f.event,i=d({},f.event);delete f.event,g=new l.Settings({color:new l.RGBA(0,0,0,100),width:20,draw:0,layer:0}),g.create(e),e.extend({setting:f,style:g}),e.extend({settings:f,on:function(a,b){return h.on(a,b)},init:function(g){var h=d({},i);return setTimeout(function(){var d;console.groupCollapsed("%c[drawpad.history.replay] Start init state.","color: darkgreen; font-weight: bold"),"undefined"!=typeof e.layer?(e.layer.root(g.layer),e.layer.regisPad(e),e.layer.create(),console.log("%c[drawpad.init] Init object.Layer Created.","font-weight: bold; color: darkgreen")):(d="Init not successful, layer not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d),h.run("error",e,{message:d})),"undefined"!=typeof e.mouseEvent?(c(b).mousemove(this.mouseEvent.move),c(a).mousedown(this.mouseEvent.down),c(a).mouseup(this.mouseEvent.up),console.log("%cEvents have been set.","font-weight: bold; color: darkgreen")):(d="Init not successful, mouseEvent not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d),h.run("error",e,{message:d})),"undefined"!=typeof e.modes?(e.modes.regisPad(e),console.log("%cModes node has been set.","font-weight: bold; color: darkgreen")):(d="Init not successful, modes not loaded",console.warn("%c[drawpad.init] %s","font-weight: bold; color: darkgreen",d),h.run("error",e,{message:d})),e.layer.write(new l.Layer(0,"drawpad-write",f.get("CANVAS_WIDTH"),f.get("CANVAS_HEIGHT"))),g.write.append(e.layer.write().getDOM("$")),console.log("%c[drawpad.init] Pen layer has been set.","font-weight: bold; color: darkgreen"),e.layer.index(0),console.groupEnd(),h.run("ok",e,{})},1),h},setStyle:function(a,b){var c,d,f,h;if(void 0!==typeof b)switch(String.toString(a).toLowerCase()){case"rgba":d=new l.RGBA(b),f=d.getCSS(),h=d.aplha()/255,c=e.layer.write().getDOM("context"),c.strokeStyle=f,c.fillStyle=f,c.globalAlpha=h,g.set("rgba",d);break;case"width":c=e.layer.write().getDOM("context"),c.lineWidth=b,g.set("width",b);break;case"layer":g.set("layer",b)}else for(var i in a)e.setStyle(i,a[i]);return this},getStyle:function(a){return g.get(a)}})},n=function(){var a,b;b=new l.Settings({index:0,data:[],write:!1,root:!1,count:0,pad:!1}),b=b.create(this),a=function(b){return"undefined"==typeof b&&(b=a.getLayer()),"undefined"==typeof b.layer&&(b=a.getLayer(b)),b};var e;d(a,{regisPad:function(a){b.get("pad")===!1&&(b.set("pad",a),e=a)},root:function(a){return b.get("root")!==!1||void 0===a?b.get("root"):(b.set("root",a),this)},write:function(a){return b.get("write")===!1&&"undefined"!=typeof a?b.set("write",a):b.get("write"),this},create:function(){a=new l.Layer(b.add("indexCount"),"drawpad",e.setting.get("CANVAS_WIDTH"),e.setting.get("CANVAS_HEIGHT")),b.root.append(a.getDOM("$")),o.get("CreateLayer").eventSave(),b.get("data").push(a),this.callback.create(a)},remove:function(a){var c=b.get("data"),d;if(isNaN(d))for(;-1!==(d=c.indexOf(a));)this.remove(d);else"undefined"!=typeof c[d]&&(c[d].remove(),this.data.splice(d,1));return this},removeAll:function(){c.each(this.data,function(a,b){b.DOM.$.remove()}),this.data=[],this.resetCount(),console.log("%c[drawpad.layer.removeAll] All layer was removed.","font-weight: bold; color: darkorange"),this.callback.removeAll()},index:function(a){if("undefined"==typeof a)return this.getLayer();if(isNaN(a)){if(0>a)return!1;if(a===b.get("index"))return!0;if(a>b.get("data").length)return!1;this.write().order(a),b.set("index",a),console.log("%c[drawpad.layer.index] Layer index changed to [%i].","font-weight: bold; color: darkorange",a);try{e.setStyle("layer",a)}catch(c){console.warn("[drawpad.layer.index] Error in style.layer.")}this.getLayer().changethis()}else if(a.layer){var d;if(-1===(d=b.get("data").indexOf(a)))return!1;this.index(d)}return!0},set:function(a){var b,c,d;switch(c=this(),b=this.defines.options,a.mode){case b.opacity:d=c.opacity(),c.opacity(a.value);break;case b.name:d=c.name(),c.name(a.value)}var f={mode:a.mode,oldvalue:d,newvalue:a.value};e.modes.ChangeLayerSetting.eventSave(f)},clear:function(){c.each(this.data,function(a,b){b.clear()})},defines:{options:{opacity:0,name:1,order:2}},getLayer:function(a){return"undefined"==typeof a?b.get("data",b.get("index")):b.isset("data",a)?!1:b.get("data")[a]},resetCount:function(){b.set("count",0)}})};n=n();var o=function(){var a={},b=new l.Settings({data:{}});b=b.create(this),c.extend(a,{regisPad:function(a){var c=b.get("data");for(var d in c)c[d].regisPad(a)},add:function(a,c){return c&&c.mode?void(b.isset("data",a)||b.isset("data",c.name)?console.warn("[drawpad.mode.add] index [%d] OR name [%s] was already defined.",a,c.name):(c.defines=this.defines,b.set("data",a,c),b.set("data",c.name,c),this.defineMode[c.name]=a,this.defineMode[a]=c.name,console.log("%c[drawpad.modes.add] drawpad.object.Mode named [%s] was added to drawpad.modes[%d], drawpad.modes.%s","font-weight: bold; color: darkred",c.name,a,c.name))):(console.warn("[drawpad.modes.add] Invalid parameter type."),!1)},get:function(a){return b.isset("data",a)?b.get("data",a):new l.Mode},defineMode:{},defines:{drawType:0,time:1,axis:2,value:2,layer:3}})};o=o();var p=function(){var a=new l.Settings({lastMouseClickedState:!1,lastMouse:{x:0,y:0},axis:[],drawState:!1,lastSamePoint:0,previousDrawpad:!1,pad:!1});a=a.create("index");var b;return l.Mode({name:"Line",thisIndex:0,regisPad:function(c){a.get("pad")===!1&&(a.set("pad",c),b=c)},play:function(a,c){function d(){c(i)}function e(){for(var c=j;c-->0;){var k=new b.object.Position(a[f.axis][g-1]),l=new b.object.Position(a[f.axis][g]);if(i.draw(k,l),g++,g>=h-1)return void b.history.save(d)}setTimeout(function(){e()},b.settings.get("TIME_DELAY")/b.settings.get("replaySpeed"))}var f=this.defines;if(!this.dataCheck(a))return!1;if(a[f.axis].length<2)return!0;b.history.data.drawingState=!0,b.layer.index(a[f.layer]),b.setStyle(a[f.color],a[f.width]);var g=1,h=a[f.axis].length,i=this,j=b.settings.get("replaySpeed")/b.settings.get("TIME_DELAY");setTimeout(function(){e()},b.settings.get("TIME_DELAY")/b.settings.get("replaySpeed"))},draw:function(a,b){a.compare(b)&&(b.x(b.x()+1),b.y(b.y()+1));var c=this.pad.layer.write().getDOM("context");c.beginPath(),c.lineJoin="round",c.lineCap="round",c.moveTo(a.x(),a.y()),c.lineTo(b.x(),b.y()),c.closePath(),c.stroke()},eventTrigger:function(){var c=a,d=b.mouseEvent;c.get("lastMouseClickedState")!==d.mouseClicked?d.mouseInner?d.mouseClicked?this.eventStart():this.eventStop():d.mouseClicked||this.eventStop():d.mouseClicked&&d.mouseIn?c.get("lastMouseInState")!==d.mouseIn?d.mouseIn?this.eventStart():this.eventStop():c.get("drawState")&&this.eventAdd():d.mouseIn||this.eventStop(),c.set("lastMouseClickedState",d.mouseClicked),c.set("lastMouseInState",d.mouseIn),c.get("drawState")?b.setStyle("flow",!0):b.setStyle("flow",!1)},eventStart:function(){var c=a,d=b.mouseEvent;this.data.drawState=!0;var e=new b.object.Position(d.mouse.pos),f=[];f.push(e.getInt()),c.set("axis",f),c.set("lastMouse",e),b.history.countTime()},eventAdd:function(){var c=a,d=b.mouseEvent,e=new l.Position(d.pos);return e.compare(c.get("lastMouse"))?c.add("lastSamePoint"):c.add("lastSamePoint",0),c.get("lastSamePoint")>b.settings.get("SAMEPOINT_LIMIT")?!1:(this.draw(c.get("lastMouse"),e),c.get("axis").push(e.getInt()),c.set("lastMouse",e),void b.history.countTime())},eventStop:function(){var b=a;return b.get("drawState")?(b.set("drawState",!1),b.set("lastSamePoint",0),this.eventAdd(),this.eventSave(),c("#value_jsize").html((history.getSize()/1024).toFixed(2)+" KB"),void c("#value_msize").html((history.getMsgPackSize()/1024).toFixed(2)+" KB")):!1},eventSave:function(){var b=a,c=b.get("pad"),d=this.defines,e={};e[d.drawType]=this.thisIndex,e[d.time]=c.history.getTime()-b.get("data","axis").length,e[d.axis]=b.get("axis"),e[d.layer]=c.layer.index(),c.history.countEvent(),c.history.addEvent(e);var f=this;c.history.addHistory({data:{img:c.layer.getDataURI,mode:this.thisIndex,layer:c.layer()},undo:function(a,b){for(c.layer.index(this.data.layer);a.index()>0&&a.back().data.mode!==f.thisIndex&&a.now().data.layer!==this.data.layer;);a.index()<0?c.layer().clear():c.layer().setDataURL(a.now().data.img),"function"==typeof b&&b()},redo:function(a,b){c.layer.index(this.data.layer),c.layer().setDataURL(this.data.img),"function"==typeof b&&b()}})}})};p=p();var q=function(){var a=new l.Settings({pad:!1});a=a.create("pad");var b;l.Mode({name:"CreateLayer",thisIndex:1,regisPad:function(c){a.get("pad")===!1&&(a.set("pad",c),b=c)},play:function(a,c){var d=this;return this.dataCheck(a)?(b.layer.create(),void(c&&c(d))):!1},eventTrigger:function(){},eventSave:function(){var a={};a[this.defines.drawType]=this.thisIndex,a[this.defines.time]=b.history.getTimeStep(),b.history.countTime(),b.history.countEvent(),b.history.addEvent(a),b.history.addHistory({data:{layer:b.layer.getLayer()},undo:function(a){b.layer.remove(this.data.layer),"function"==typeof a&&a()},redo:function(a){b.layer.create(),"function"==typeof a&&a()}})}})};q=q();var r=function(){var a=new l.Settings({pad:!1,data:[]});a=a.create("pad");var b;return l.Mode({name:"ChangeLayerSetting",regisPad:function(c){a.get("pad")===!1&&(a.set("pad",c),b=c)},thisIndex:2,play:function(a,c){var d=this.define,e=this;return this.dataCheck(a)?(isNaN(a[d.axis])?b.layer.set(a[d.layer],{mode:a[d.axis][0],value:a[d.axis][1]},!1):b.layer.set(a[d.layer],b.layer.value.getValue(a[d.value],!1)),void(c&&c(e))):!1},eventTrigger:function(){},eventSave:function(a){var c={},e=this.defines;c[e.drawType]=this.thisIndex,c[e.mode]=a.mode,c[e.value]=a.newvalue,c[e.time]=b.history.getTime(),b.history.countTime(),b.history.countEvent(),b.history.addEvent(c),b.history.addHistory({data:d(a,{mode:this.thisIndex,layer:b.layer()}),undo:function(){b.layer.index(this.data.layer),b.layer.set({mode:this.data.mode,value:this.data.oldvalue})},redo:function(){b.layer.index(this.data.layer),b.layer.set({mode:this.data.mode,value:this.data.newvalue})}})}})};r=r();var s=function(){return o.add(0,p),o.add(1,q),o.add(2,r),o};o=s(),s=void 0,m.extend({layer:n,modes:o});var t={},u={Pad:m,PadUI:void 0,window:a,jQuery:c,document:b},v={},w=function(a){return a&&u[a]?u[a]:!1};d(v,{ok:{status:function(){return 0===e.length},call:function(a){a(w)}},error:{status:function(){return 0!==e.length},call:function(a){a(e)}}}),t.on=function(a,d){return c(b).ready(function(){"undefined"!=typeof v[a]&&v[a].status()&&v[a].call(d)}),this},f(["drawpad"],function(b){a.drawpad=b})});